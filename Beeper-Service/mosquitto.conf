# Mosquitto configuration for production

# MQTT Protocol Settings
listener 1883 0.0.0.0
protocol mqtt
max_connections 100
max_keepalive 300

# WebSocket listener (internal Docker network; Caddy will handle SSL)
listener 9001 0.0.0.0
protocol websockets
max_connections 50

# Performance & Resource Management
max_inflight_messages 10
max_queued_messages 100
message_size_limit 8192
persistent_client_expiration 1m

# Persistence
persistence true
persistence_location /mosquitto/data/
persistence_file mosquitto.db
autosave_interval 300
autosave_on_changes false

# Memory Management
memory_limit 32MB
sys_interval 10

# Logging
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# Connection logging
connection_messages true

# Security
allow_anonymous false
password_file /mosquitto/config/passwd
acl_file /mosquitto/config/acl

# Client timeout settings
keepalive_interval 60
retry_interval 20
max_inflight_bytes 1024

# Bridge settings for future scaling (disabled)
# bridge_attempt_unsubscribe false
# bridge_protocol_version mqttv311
